var h="https://editor.unlayer.com/embed.js?2",f=[],p=!1,g=t=>{let n=document.querySelectorAll("script"),e=!1;return n.forEach(r=>{r.src.includes(t)&&(e=!0)}),e},y=t=>{f.push(t)},u=()=>{if(p){let t;for(;t=f.shift();)t()}},S=(t,n=h)=>{if(y(t),g(n))u();else{let e=document.createElement("script");e.setAttribute("src",n),e.onload=()=>{p=!0,u()},document.head.appendChild(e)}};function m({state:t,displayMode:n,id:e,uploadUrl:r}){return{state:t,init(){let a=this;S(()=>{unlayer.init({id:e,displayMode:n}),unlayer.registerCallback("image",(l,i)=>{b(l.attachments[0],r).then(s=>i({progress:100,url:s})).catch(s=>console.error("Image upload failed:",s))});let o=!1,d=!0;a.$watch("state",l=>{if(!o){let i=l.design!==void 0?l.design:l;unlayer.loadDesign(JSON.parse(JSON.stringify(i))),d=!1,unlayer.exportHtml(s=>{o=!0,a.state&&(a.state={html:s.html,design:JSON.parse(JSON.stringify(s.design))});let c=document.getElementById(e);c&&(c.dirty=!0),d=!1})}o=!1}),unlayer.addEventListener("design:updated",()=>{unlayer.exportHtml(l=>{d||(o=!0),a.state&&(a.state=d?{html:a.state.html,design:JSON.parse(JSON.stringify(a.state.design))}:{html:l.html,design:JSON.parse(JSON.stringify(l.design))});let i=document.getElementById(e);i&&(i.dirty=!0),d=!1})})})}}}function b(t,n){let e=new FormData;return e.append("file",t),fetch(n,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e}).then(r=>{if(r.ok)return r.json();throw new Error("Network response was not ok.")}).then(r=>r.file.url)}document.addEventListener("DOMContentLoaded",()=>{typeof Alpine<"u"&&Alpine.data("initUnlayer",m)});export{m as default,S as loadScript};
